---
title: Open FGAã‚’ç”¨ã„ã¦Relationship-Based Access Controlã‚’ä½“é¨“ã™ã‚‹
emoji: "ğŸ”‘"
type: "tech"
topics: ["openfga", "authorization", "rbac", "zanzibar"]
published: false
---

---

## æœ¬è¨˜äº‹ã®ç›®çš„
- Open FGAã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆã‚’æ•´ç†ã™ã‚‹
- Open FGAã®ä½¿ã„æ–¹ã‚’æ•´ç†ã™ã‚‹

## æƒ³å®šèª­è€…

- èªå¯ã«ã¤ã„ã¦æ¦‚è¦ã‚’æŠŠæ¡ã—ã¦ã„ã‚‹ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢
  - ãƒªã‚½ãƒ¼ã‚¹ä¿è­·ã®ä»•çµ„ã¿ã ã‚ˆãªã‚ã€ãã‚‰ã„ã§OK

## Open FGAã®æ¦‚è¦

### Open FGAãŒç”Ÿã¾ã‚ŒãŸèƒŒæ™¯

### Relationship-Based Access Control (ReBAC)ã®æ¦‚è¦

- ACL/RBACã¨ã®æ¯”è¼ƒ

## Open FGA

### FGAã‚µãƒ¼ãƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### èªå¯ã®å‹•ä½œæ¤œè¨¼

### èªå¯ãƒ¢ãƒ‡ãƒ«ã®ãƒ†ã‚¹ãƒˆ

```

```mermaid
flowchart LR
  user[[user]]
  doc[[document]]

  subgraph relations
    owner:::rel --> editor:::rel --> viewer:::rel
  end

  doc -. owner .-> owner
  owner -. editor .-> editor
  editor -. viewer .-> viewer

  classDef rel fill:#dbeafe,stroke:#2563eb
  style user fill:#fff
  style doc  fill:#fff
```

```mermaid
sequenceDiagram
  participant Client
  participant App
  participant fga as Open FGA<br>Sever

  Client->>App: GET /docs/:id (X-User-Id: alice)
  App->>fga: POST /check<br>{tuple_key:{user,relation,object}}
  fga-->>App: {allowed:true}
  App-->>Client: 200 OK
```

## RBAC â€” çµ„ç¹”å†…ã§ã®å½¹å‰²ï¼ˆãƒ­ãƒ¼ãƒ«ï¼‰ã«åŸºã¥ã„ãŸæ¨©é™ä»˜ä¸

```mermaid
flowchart LR
  bob -. member .-> role["role:Editor"]
  role -. includes .-> fileA
```

* **é•·æ‰€**

  * æ¨©é™å®šç¾©ã‚’ãƒ­ãƒ¼ãƒ«è¡¨ã«é›†ç´„ã§ãã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç•°å‹•ã¯ â€œãƒ­ãƒ¼ãƒ«ã®ä»˜ã‘å¤–ã—â€ ã ã‘ã§æ¸ˆã‚€
  * å®Ÿè£…ãŒæ¯”è¼ƒçš„å˜ç´”ï¼ˆDB ã§ã‚‚ IAM ã§ã‚‚åºƒãã‚µãƒãƒ¼ãƒˆï¼‰
* **çŸ­æ‰€**

  * ä¾‹å¤–ãŒå¢—ãˆã‚‹ãŸã³ãƒ­ãƒ¼ãƒ«ã®ã‚³ãƒ”ãƒ¼ã‚’ä½œã‚Š **â€œãƒ­ãƒ¼ãƒ«çˆ†ç™ºâ€** ãŒèµ·ãã‚‹
  * å¤šéšå±¤ãƒ­ãƒ¼ãƒ«ï¼ˆManagerâ†’Leadâ†’â€¦ï¼‰ã¯ if/else ãƒã‚¹ãƒˆã«ãªã‚ŠãŒã¡

---

## ABAC â€” å±æ€§å¼ã§å‹•çš„ã«åˆ¤å®š

```mermaid
flowchart LR
  user[("dept: HR<br>age: 25")] -- dept==HR <br> and age 20 ä»¥ä¸Š --> fileA
```

* **é•·æ‰€**

  * æ™‚åˆ»ãƒ»IPãƒ»é‡‘é¡ãªã© **å‹•çš„å€¤ã§æŸ”è»Ÿã«åˆ¶å¾¡**
  * â€œãƒ­ãƒ¼ãƒ«â€ ã‚’ä½œã‚‰ãšã¨ã‚‚è¤‡é›‘æ¡ä»¶ã‚’è¨˜è¿°ã§ãã‚‹
* **çŸ­æ‰€**

  * åˆ¤å®šã«å¿…è¦ãªå±æ€§ãŒå„ã‚µãƒ¼ãƒ“ã‚¹ã‚„ DB ã«æ•£åœ¨ â‡’ **ãƒ‡ãƒ¼ã‚¿åé›†ãŒå¤§å¤‰**
  * ãƒãƒªã‚·ãƒ¼ãŒ æ¡ä»¶å¼ã§å¢—æ®–ã—ã€**ã€Œèª°ãŒä½•ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹ã€å¯è¦–åŒ–ã—ã«ãã„**

---

## ReBAC â€” é–¢ä¿‚ã‚°ãƒ©ãƒ•ã§èªå¯ã‚’è¡¨ç¾

```mermaid
flowchart LR
  charlie -- admin --> org["org:acme"]
  org     -- owner --> doc["document:spec.pdf"]
```

* **é•·æ‰€**

  * **ç¶™æ‰¿ãƒ»å§”ä»»ãŒè‡ªç„¶ã«æ›¸ã‘ã‚‹**
    *ã€ŒA ãŒ org.admin â†’ org ãŒ doc.ownerã€* ã®ã‚ˆã†ã«
    1 æœ¬ã®ã‚¨ãƒƒã‚¸ã‚’è¶³ã™ã ã‘ã§è¤‡é›‘ãªå¤šæ®µç¶™æ‰¿ã‚’è¡¨ç¾ã§ãã‚‹ã€‚
  * **æ§‹é€ ãŒâ€œã‚°ãƒ©ãƒ•â€ãªã®ã§å¯è¦–åŒ–ã—ã‚„ã™ã„**
    ãƒãƒ¼ãƒ‰ã¨ã‚¨ãƒƒã‚¸ã‚’æãã ã‘ã§ã€èª°ãŒã©ã“çµŒç”±ã§æ¨©é™ã‚’å¾—ã‚‹ã‹ä¸€ç›®ã§è¿½ãˆã‚‹ã€‚
  * **æ¨©é™ãƒ‡ãƒ¼ã‚¿ãŒ 1 ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆã‚¿ãƒ—ãƒ«ï¼‰ã«é›†ç´„**
    ãƒ¦ãƒ¼ã‚¶ãƒ¼å±æ€§ãƒ»ãƒ­ãƒ¼ãƒ«è¡¨ãƒ»ä¾‹å¤–ãƒªã‚¹ãƒˆã‚’åˆ¥ã€…ã«æŒã¤å¿…è¦ãŒãªãã€
    ã‚¹ãƒˆã‚¢ãŒå¤§ãããªã£ã¦ã‚‚å‚ç…§ç®‡æ‰€ãŒæ•£ã‚‰ã°ã‚Šã«ãã„ã€‚

* **çŸ­æ‰€**

  * **æ¦‚å¿µãŒå¾“æ¥ ACL/RBAC ã‹ã‚‰é›¢ã‚Œã¦ãŠã‚Šå­¦ç¿’ã‚³ã‚¹ãƒˆãŒé«˜ã„**
    ã€Œæ¨©é™ï¼è¡Œ or ãƒ­ãƒ¼ãƒ«ã€ã§ã¯ãªãã€Œé–¢ä¿‚ï¼ã‚°ãƒ©ãƒ•ã€ã¨ã„ã†æ€è€ƒè»¢æ›ãŒå¿…é ˆã€‚

---

> âœ… **é¸ã³åˆ†ã‘ã®æŒ‡é‡**
> *å‹•çš„å±æ€§ãŒã‚­ãƒ¼ â†’ ABAC*
> *çµ„ç¹”ãƒ»ãƒ•ã‚©ãƒ«ãƒ€éšå±¤ãŒæ·±ã„ â†’ ReBAC*
> *å°è¦æ¨¡ã§å›ºå®šãƒ­ãƒ¼ãƒ«ã ã‘ â†’ RBAC*

```

---

# å‚è€ƒ
- https://workos.com/blog/what-is-rebac-relationship-based-access-control
- https://workos.com/blog/rbac-vs-abac
- https://openfga.dev/docs/authorization-concepts
- https://auth0.com/blog/jp-whats-the-right-authorization-model-for-my-application/