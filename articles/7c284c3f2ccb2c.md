---
title: "Playwright Agentsを使ったテスト計画・コード・自動修復のサイクル検証"
emoji: "🧪"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["playwright", "テスト自動化", "MCP"]
published: true
published_at: 2025-11-26 18:00
---

# はじめに

Playwright公式が、テストの計画・実装・修正を行うエージェントを提供し始めたようなので試してみる。
<https://playwright.dev/docs/test-agents>

# Playwright Agentsを使ってみる

## 環境

- Windows11上のWSL2 (Ubuntu)

## 事前準備

### Playwrightインストール

```bash
npm init playwright@latest
```

<https://playwright.dev/docs/intro>

## 手順

### 1. `Playwright Agent`をインストール

```bash
npx playwright init-agents --loop=vscode
```

コマンドを実行したディレクトリに、いくつかファイルが生成されている

```
Need to install the following packages:
playwright@1.56.1
Ok to proceed? (y) y

Writing file: .github/chatmodes/🎭 generator.chatmode.md
Writing file: .github/chatmodes/🎭 healer.chatmode.md
Writing file: .github/chatmodes/ 🎭 planner.chatmode.md
Writing file: .vscode/mcp.json
Writing file: seed.spec.ts
```

:::message
私の環境だと、`mcp.json`に`--headless`オプションを加えないとMCPサーバ側でエラーが発生しました。
:::

### 2. `VSCode Insiders`を起動

:::message
VSCodeの正式版には含まれてない実験的機能を使っているらしいので、
VSCode Insidersで動かした方が無難かも（そのうち正式版で問題なくなる？）
:::

CopilotのChatペインに、エージェントが増えている。
![chat-pain](/images/playwright-test-poc/chat-pain.png)

### 3. エージェントにテスト計画してもらう

ローカルに適当なアプリを立ち上げた上で、`planner`エージェントに以下を指示。
![planner-instruct](/images/playwright-test-poc/planner-instruct.png)

仕様書を生成してくれた。
![planner-gen1-1](/images/playwright-test-poc/planner-gen1-1.png)
![planner-gen1-2](/images/playwright-test-poc/planner-gen1-2.png)

同じコンテキストで、テスト計画書作成もお願いしてみる。
![test-plan-instruct](/images/playwright-test-poc/test-plan-insturct.png)
![test-plan](/images/playwright-test-poc/test-plan.png)

### 4. テストの実装

`generator`エージェントにテスト計画に沿ったテスト実装を指示。
![test-gen-instruct](/images/playwright-test-poc/test-gen-instruct.png)

テストコードをもりもり作成していく。

```ts
// spec: docs/webapp-test-plan.md
// seed: tests/seed.spec.ts
// Scenario: 5.5 サインアップ（正常系）
import { test, expect } from '@playwright/test';

test.describe('シナリオ 5.5 サインアップ（正常系）', () => {
  test('5.5 サインアップ（正常系）', async ({ page }) => {
    // 1. /register を開く
    await page.goto('http://localhost:4200/register');

    // 2. Username/Email/Password を有効値で入力
    const username = `e2e_signup_${Date.now()}`;
    const email = `${username}@example.com`;
    await page.getByRole('textbox', { name: 'Username' }).fill(username);
    await page.getByRole('textbox', { name: 'Email' }).fill(email);
    await page.getByRole('textbox', { name: 'Password' }).fill('Passw0rd!');

    // 3. Sign up をクリック
    await page.getByRole('button', { name: 'Sign up' }).click();

    // 期待結果: Home に遷移、ヘッダがログイン状態に変化
    await expect(page.getByRole('link', { name: 'New Article' })).toBeVisible();
    await expect(page.getByRole('link', { name: 'Settings' })).toBeVisible();
    await expect(page.getByRole('link', { name: username })).toBeVisible();

    // 期待結果: LocalStorage に JWT 保存
    const token = await page.evaluate(() => window.localStorage.getItem('jwtToken'));
    expect(token, 'jwtToken should be set in localStorage').toBeTruthy();
  });
});
```

![images/playwright-test-poc/fail-result](/images/playwright-test-poc/fail-result.png)

- たくさん失敗している

### テストの修正

ヒーラーエージェントに修正をお願いしてみる。
![healer-agent](/images/playwright-test-poc/healer-agent.png)

- 何回かやりとりしたらすべてPassedになった
![all-passes](/images/playwright-test-poc/all-passes-result.png)

# おわりに

- 雑に使ったけど、結構使いやすかった
- テスト自動化のとっかかりとしては良いかも
- MCP活用してもっと開発効率上げていきたい。
- テストケースとして価値があるのか、実装は妥当かなどチェックはいる
  - それ自体もプロンプトにいれるべき

# 補足：Playwright Agentsの実装調査

- `mcp.json`記載の`run-test-mcp-server`コマンドの実装は以下
  - <https://github.com/microsoft/playwright/blob/3afe7ba8c020e1f69c703dce1801d258bd726f89/packages/playwright/src/program.ts#L157>
